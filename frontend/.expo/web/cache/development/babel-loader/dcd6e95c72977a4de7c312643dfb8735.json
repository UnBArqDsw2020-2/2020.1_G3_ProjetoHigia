{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/home/viktor/2020.2_G3_ProjetoHigia/frontend/src/context/auth.js\";\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useContext, createContext, useState, useEffect } from 'react';\nimport AsyncStorage from '@react-native-community/async-storage';\nimport firebase from 'firebase';\nimport api from \"../services/api\";\nvar AuthContext = createContext();\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      user = _useState2[0],\n      setUser = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  useEffect(function () {\n    function loadStoragedData() {\n      var storageUser, storageToken;\n      return _regeneratorRuntime.async(function loadStoragedData$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem('@RNAuth:user'));\n\n            case 2:\n              storageUser = _context.sent;\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem('@RNAuth:token'));\n\n            case 5:\n              storageToken = _context.sent;\n\n              if (storageUser && storageToken) {\n                api.defaults.headers.Authorization = \"Bearer \" + storageToken;\n                setUser(JSON.parse(storageUser));\n              }\n\n              setLoading(false);\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n\n    loadStoragedData();\n  }, []);\n\n  function signIn(email, password) {\n    var response;\n    return _regeneratorRuntime.async(function signIn$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            setLoading(true);\n            _context2.prev = 1;\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(firebase.auth().signInWithEmailAndPassword(email, password));\n\n          case 4:\n            response = _context2.sent;\n            setUser(response.user.providerData[0]);\n            api.defaults.headers.Authorization = \"Bearer \" + JSON.stringify(response.user.toJSON().stsTokenManager.accessToken);\n            _context2.next = 9;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem('@RNAuth:user', JSON.stringify(response.user.providerData[0])));\n\n          case 9:\n            _context2.next = 11;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem('@RNAuth:token', JSON.stringify(response.user.toJSON().stsTokenManager.accessToken)));\n\n          case 11:\n            _context2.next = 16;\n            break;\n\n          case 13:\n            _context2.prev = 13;\n            _context2.t0 = _context2[\"catch\"](1);\n            console.log(_context2.t0);\n\n          case 16:\n            setLoading(false);\n\n          case 17:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[1, 13]], Promise);\n  }\n\n  function signIn(email, password) {\n    var response;\n    return _regeneratorRuntime.async(function signIn$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            setLoading(true);\n            _context3.prev = 1;\n            _context3.next = 4;\n            return _regeneratorRuntime.awrap(firebase.auth().createUserWithEmailAndPassword(email, password));\n\n          case 4:\n            response = _context3.sent;\n            setUser(response.user.providerData[0]);\n            api.defaults.headers.Authorization = \"Bearer \" + JSON.stringify(response.user.toJSON().stsTokenManager.accessToken);\n            _context3.next = 9;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem('@RNAuth:user', JSON.stringify(response.user.providerData[0])));\n\n          case 9:\n            _context3.next = 11;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem('@RNAuth:token', JSON.stringify(response.user.toJSON().stsTokenManager.accessToken)));\n\n          case 11:\n            _context3.next = 16;\n            break;\n\n          case 13:\n            _context3.prev = 13;\n            _context3.t0 = _context3[\"catch\"](1);\n            console.log(_context3.t0);\n\n          case 16:\n            setLoading(false);\n\n          case 17:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[1, 13]], Promise);\n  }\n\n  function signOut() {\n    AsyncStorage.clear().then(function () {\n      setUser(null);\n    });\n  }\n\n  return React.createElement(AuthContext.Provider, {\n    value: {\n      signed: !!user,\n      user: user,\n      loading: loading,\n      signIn: signIn,\n      signOut: signOut\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 5\n    }\n  }, children);\n};\nexport function useAuth() {\n  var context = useContext(AuthContext);\n  return context;\n}","map":{"version":3,"sources":["/home/viktor/2020.2_G3_ProjetoHigia/frontend/src/context/auth.js"],"names":["React","useContext","createContext","useState","useEffect","AsyncStorage","firebase","api","AuthContext","AuthProvider","children","user","setUser","loading","setLoading","loadStoragedData","getItem","storageUser","storageToken","defaults","headers","Authorization","JSON","parse","signIn","email","password","auth","signInWithEmailAndPassword","response","providerData","stringify","toJSON","stsTokenManager","accessToken","setItem","console","log","createUserWithEmailAndPassword","signOut","clear","then","signed","useAuth","context"],"mappings":"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","sourcesContent":["import React, { useContext, createContext, useState, useEffect } from 'react';\nimport AsyncStorage from '@react-native-community/async-storage';\nimport firebase from 'firebase';\nimport api from '../services/api';\n\nconst AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    async function loadStoragedData() {\n      const storageUser = await AsyncStorage.getItem('@RNAuth:user');\n      const storageToken = await AsyncStorage.getItem('@RNAuth:token');\n\n      if (storageUser && storageToken) {\n        api.defaults.headers.Authorization = `Bearer ${storageToken}`;\n        setUser(JSON.parse(storageUser));\n      }\n      setLoading(false);\n    }\n\n    loadStoragedData();\n  }, []);\n\n  async function signIn(email, password) {\n    setLoading(true);\n\n    try {\n      const response = await firebase\n        .auth()\n        .signInWithEmailAndPassword(email, password);\n\n      setUser(response.user.providerData[0]);\n\n      api.defaults.headers.Authorization = `Bearer ${JSON.stringify(\n        response.user.toJSON().stsTokenManager.accessToken\n      )}`;\n\n      await AsyncStorage.setItem(\n        '@RNAuth:user',\n        JSON.stringify(response.user.providerData[0])\n      );\n      await AsyncStorage.setItem(\n        '@RNAuth:token',\n        JSON.stringify(response.user.toJSON().stsTokenManager.accessToken)\n      );\n    } catch (err) {\n      console.log(err);\n    }\n\n    setLoading(false);\n  }\n\n  async function signIn(email, password) {\n    setLoading(true);\n\n    try {\n      const response = await firebase\n        .auth()\n        .createUserWithEmailAndPassword(email, password);\n\n      setUser(response.user.providerData[0]);\n\n      api.defaults.headers.Authorization = `Bearer ${JSON.stringify(\n        response.user.toJSON().stsTokenManager.accessToken\n      )}`;\n\n      await AsyncStorage.setItem(\n        '@RNAuth:user',\n        JSON.stringify(response.user.providerData[0])\n      );\n      await AsyncStorage.setItem(\n        '@RNAuth:token',\n        JSON.stringify(response.user.toJSON().stsTokenManager.accessToken)\n      );\n    } catch (err) {\n      console.log(err);\n    }\n\n    setLoading(false);\n  }\n\n  function signOut() {\n    AsyncStorage.clear().then(() => {\n      setUser(null);\n    });\n  }\n\n  return (\n    <AuthContext.Provider\n      value={{ signed: !!user, user, loading, signIn, signOut }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  return context;\n}\n"]},"metadata":{},"sourceType":"module"}